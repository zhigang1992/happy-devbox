---
title: \!commands don't pass through properly
status: closed
priority: 2
issue_type: task
created_at: 2025-12-01T19:35:13.867048466+00:00
updated_at: 2026-01-04T18:25:00.000000000+00:00
---

# Description

When entering '\!pwd' or '\!ls' in Claude Code, this is passed through as a shell command without wasting model tokens. But via Happy it's passed to the AI agent which kind of works but has more waste. We should properly pass through '\!' commands.

# Resolution

Fixed by implementing direct command execution in happy-cli. Changes made:

1. **Added parseDirectCommand()** in `src/parsers/specialCommands.ts`
   - Detects messages starting with "!" prefix
   - Extracts the shell command to execute
   - Added to SpecialCommandResult type as 'direct-command'

2. **Implemented handler in claudeRemote.ts**
   - Intercepts "!" commands before sending to Claude Code SDK
   - Executes commands directly using Node's exec()
   - Returns output as synthetic SDK messages (bypasses AI completely)
   - No model tokens are used for "!" commands
   - Timeout: 30 seconds
   - Working directory: session's current path

The fix ensures that "!" commands in Happy work identically to native Claude Code CLI - executing shell commands directly without AI involvement.
